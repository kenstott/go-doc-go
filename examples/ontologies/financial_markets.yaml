# ==========================================
# YAML ANCHORS - MAXIMUM COMPRESSION
# ==========================================

# === CONFIDENCE LEVELS ===
confidence:
  very_high: &very_high 0.80
  high: &high 0.75
  medium: &medium 0.70  
  low: &low 0.65
  very_low: &very_low 0.60

# === SEMANTIC PHRASES ===
phrases:
  # Companies and organizations
  company: &company_phrase "company, corporation, firm, business, enterprise, we, our"
  company_short: &company_short "company, we, our"
  company_firm: &company_firm "company, we, our firm"
  competitor: &competitor_phrase "competitor, rival, competing firm, peer"
  customer: &customer_phrase "customer, client, account, buyer"
  supplier: &supplier_phrase "supplier, vendor, partner"
  
  # People
  executive: &exec_phrase "CEO, CFO, president, chief executive, chief financial"
  ceo: &ceo_phrase "CEO, chief executive officer, chief executive"
  cfo: &cfo_phrase "CFO, chief financial officer, finance chief"
  analyst: &analyst_phrase "analyst, research analyst, equity analyst, investment analyst"
  speaker: &speaker_phrase "speaker, presenter, participant in call, speaking today"
  
  # Financial metrics
  revenue: &revenue_phrase "revenue, sales, top line"
  revenue_short: &revenue_short "revenue, sales"
  earnings: &earnings_phrase "earnings, profit, net income, bottom line"
  margin: &margin_phrase "margin, profitability, gross margin, operating margin"
  growth: &growth_phrase "growth, increase, expansion, acceleration"
  guidance: &guidance_phrase "guidance, outlook, forecast, projection"
  
  # Market sentiment
  bullish: &bullish_phrase "bullish, positive, optimistic, strong, outperform"
  bearish: &bearish_phrase "bearish, negative, pessimistic, weak, underperform"
  
  # Risk and opportunity
  risk: &risk_phrase "risk, threat, challenge, headwind, concern, pressure, weakness"
  risk_short: &risk_short "risk, threat, challenge, headwind"
  opportunity: &opportunity_phrase "opportunity, potential, tailwind, catalyst, driver, strength"
  
  # Corporate actions
  acquisition: &acquisition_phrase "acquisition, merger, M&A, takeover, buyout"
  target_company: &target_phrase "target, acquired company, acquisition"
  product: &product_phrase "product, service, solution"
  stock: &stock_phrase "company, stock, shares"
  
  # Other common phrases
  management: &management_phrase "company, management, we"

# === ELEMENT TYPE FILTERS ===
elements:
  text: &text_elements ["paragraph", "list_item", "heading"]
  financial: &financial_elements ["paragraph", "table_cell", "list_item"]
  all: &all_elements ["*"]

# === RULE TEMPLATES ===
rules:
  # Semantic rule templates
  semantic_high: &semantic_high
    type: "semantic"
    confidence_threshold: *high
    
  semantic_medium: &semantic_medium
    type: "semantic"
    confidence_threshold: *medium
    
  semantic_low: &semantic_low
    type: "semantic"
    confidence_threshold: *low
    
  # With element types
  semantic_text_high: &semantic_text_high
    type: "semantic"
    confidence_threshold: *high
    element_types: *text_elements
    
  semantic_text_medium: &semantic_text_medium
    type: "semantic"
    confidence_threshold: *medium
    element_types: *text_elements
    
  semantic_text_low: &semantic_text_low
    type: "semantic"
    confidence_threshold: *low
    element_types: *text_elements
    
  # Regex templates
  regex_high: &regex_high
    type: "regex"
    case_sensitive: false
    confidence_threshold: *high
    
  regex_medium: &regex_medium
    type: "regex"
    case_sensitive: false
    confidence_threshold: *medium
    
  # Keywords templates
  keywords_low: &keywords_low
    type: "keywords"
    confidence_threshold: *low
    
  keywords_medium: &keywords_medium
    type: "keywords"
    confidence_threshold: *medium

# === RELATIONSHIP COMPONENTS ===
relationships:
  # Source endpoints
  company_source_medium: &company_source_medium
    term_id: "company"
    semantic_phrase: *company_phrase
    confidence_threshold: *medium
    
  company_source_short: &company_source_short
    term_id: "company"
    semantic_phrase: *company_short
    confidence_threshold: *medium
    
  company_source_firm: &company_source_firm
    term_id: "company"
    semantic_phrase: *company_firm
    confidence_threshold: *medium
    
  # Target bases
  exec_target_high: &exec_target_high
    confidence_threshold: *high
    
  target_medium: &target_medium
    confidence_threshold: *medium
    
  # Confidence configurations
  confidence_low: &confidence_low
    minimum: *low
    calculation: "average"
    
  confidence_medium: &confidence_medium
    minimum: *medium
    calculation: "average"
    
  # Constraints
  same_para: &same_para
    hierarchy_level: 0  # Same paragraph
    
  same_section: &same_section
    hierarchy_level: 1  # Same section
    
  same_doc: &same_doc
    hierarchy_level: -1  # Same document

# === DERIVED ENTITY TEMPLATES ===
derived:
  speaker_entity: &speaker_entity
    entity_type: "speaker"
    source_element_types: ["paragraph"]
    metadata_fields: ["speaker", "speaker_role"]
    id_template: "speaker_{name}"
    deduplication_key: "name"
    create_relationships: true
    relationship_type: "SPEAKS_IN"
    map_to_terms: true
    
  comment_entity: &comment_entity
    entity_type: "earnings_call_comment"
    source_element_types: ["paragraph"]
    metadata_fields: ["section", "speaker"]
    id_template: "comment_{element_id}"
    deduplication_key: "element_id"
    create_relationships: true
    relationship_type: "COMMENTS_ON"
    map_to_terms: true
    extract_content: true

# === ENTITY RELATIONSHIP TEMPLATES ===
entity_rels:
  speaker_company: &speaker_company_rel
    source_entity_type: "speaker"
    target_entity_type: "company"
    relationship_type: "REPRESENTS"
    confidence: *very_high
    
  same_element_match: &same_element_match
    same_source_element: true
    
  same_doc_match: &same_doc_match
    same_document: true

# ==========================================
# ONTOLOGY DEFINITION
# ==========================================

domain:
  name: "financial_markets"
  version: "1.0.0"
  description: "Financial markets ontology for extracting entities and relationships from unstructured financial documents"
  
  # Neo4j export configuration
  neo4j_export:
    document_attributes: ["company", "ticker", "quarter", "year", "date", "fiscal_period"]
    element_attributes: ["speaker", "speaker_role", "section", "contains_metrics"]
    title_templates:
      document: "{company} {quarter} {year} Earnings Call"
      element: 
        default: "{section}"
        paragraph: "{speaker} - {section}"

# Core financial market terms
terms:
  # Companies and Organizations
  - {id: "company", label: "Company", description: "Business entity or corporation", aliases: ["corporation", "firm", "business"]}
  - {id: "competitor", label: "Competitor", description: "Competing company", aliases: ["rival", "peer"]}
  - {id: "customer", label: "Customer", description: "Customer or client", aliases: ["client", "account"]}
  - {id: "supplier", label: "Supplier", description: "Supplier or vendor", aliases: ["vendor", "partner"]}
  - {id: "ticker", label: "Stock Ticker", description: "Stock ticker symbol", aliases: ["symbol", "stock"]}
  
  # Executives and People
  - {id: "ceo", label: "Chief Executive Officer", description: "CEO or president", aliases: ["CEO", "chief executive", "president"]}
  - {id: "cfo", label: "Chief Financial Officer", description: "CFO", aliases: ["CFO", "finance chief"]}
  - {id: "analyst", label: "Financial Analyst", description: "Research or equity analyst", aliases: ["equity analyst", "research analyst"]}
  - {id: "speaker", label: "Speaker", description: "Person speaking in earnings calls", aliases: ["presenter", "participant"]}
  - {id: "person", label: "Person", description: "Individual person mentioned", aliases: ["individual", "executive"]}
  
  # Financial Metrics
  - {id: "revenue", label: "Revenue", description: "Company revenue or sales", aliases: ["sales", "top line", "turnover"]}
  - {id: "earnings", label: "Earnings", description: "Profit or net income", aliases: ["profit", "net income", "bottom line"]}
  - {id: "margin", label: "Margin", description: "Profit margin", aliases: ["gross margin", "operating margin", "profit margin"]}
  - {id: "growth_rate", label: "Growth Rate", description: "Growth percentage", aliases: ["YoY", "QoQ", "CAGR"]}
  - {id: "guidance", label: "Guidance", description: "Financial guidance or outlook", aliases: ["outlook", "forecast", "projection"]}
  - {id: "eps", label: "Earnings Per Share", description: "EPS metric", aliases: ["EPS", "earnings per share"]}
  
  # Market Activities  
  - {id: "product", label: "Product", description: "Product or service", aliases: ["service", "solution", "offering"]}
  - {id: "earnings_call", label: "Earnings Call", description: "Quarterly earnings conference call", aliases: ["conference call", "quarterly call"]}
  - {id: "acquisition", label: "Acquisition", description: "Merger or acquisition", aliases: ["M&A", "merger", "takeover"]}
  - {id: "ipo", label: "Initial Public Offering", description: "IPO or public listing", aliases: ["public offering", "going public"]}
  - {id: "dividend", label: "Dividend", description: "Dividend payment", aliases: ["distribution", "payout"]}
  - {id: "buyback", label: "Share Buyback", description: "Stock repurchase", aliases: ["share repurchase", "stock buyback"]}
  
  # Ratings and Sentiment
  - {id: "rating", label: "Analyst Rating", description: "Analyst recommendation", aliases: ["recommendation", "call"]}
  - {id: "buy_rating", label: "Buy Rating", description: "Buy recommendation", aliases: ["buy", "strong buy", "overweight"]}
  - {id: "sell_rating", label: "Sell Rating", description: "Sell recommendation", aliases: ["sell", "strong sell", "underweight"]}
  - {id: "hold_rating", label: "Hold Rating", description: "Hold recommendation", aliases: ["hold", "neutral", "market perform"]}
  - {id: "price_target", label: "Price Target", description: "Stock price target", aliases: ["target price", "PT"]}
  - {id: "bullish", label: "Bullish Sentiment", description: "Positive sentiment", aliases: ["positive", "optimistic"]}
  - {id: "bearish", label: "Bearish Sentiment", description: "Negative sentiment", aliases: ["negative", "pessimistic"]}
  
  # Risk and Opportunity
  - {id: "risk", label: "Risk Factor", description: "Business or market risk", aliases: ["threat", "challenge"]}
  - {id: "opportunity", label: "Opportunity", description: "Business opportunity", aliases: ["potential", "catalyst"]}
  - {id: "volatility", label: "Market Volatility", description: "Market uncertainty", aliases: ["uncertainty", "fluctuation"]}
  
  # Business Operations
  - {id: "expansion", label: "Business Expansion", description: "Growth initiative", aliases: ["growth", "scaling"]}
  - {id: "restructuring", label: "Restructuring", description: "Corporate restructuring", aliases: ["reorganization", "transformation"]}
  - {id: "partnership", label: "Partnership", description: "Strategic partnership", aliases: ["alliance", "collaboration", "JV"]}

# Element to term mapping rules
element_mappings:
  # Companies
  - term_id: "company"
    rules:
      - {<<: *semantic_text_medium, semantic_phrase: *company_phrase}
      - {<<: *regex_high, pattern: "\\b(we|our|us)\\b", element_types: ["paragraph"]}
      
  - term_id: "competitor"
    rules:
      - {<<: *semantic_text_medium, semantic_phrase: *competitor_phrase}
      - {<<: *keywords_low, keywords: ["competitor", "rival", "competing"]}
      
  - term_id: "customer"
    rules:
      - {<<: *semantic_text_medium, semantic_phrase: *customer_phrase}
      - {<<: *keywords_low, keywords: ["customer", "client", "account"]}
      
  - term_id: "ticker"
    rules:
      - {<<: *regex_high, pattern: "\\b[A-Z]{2,5}\\b(?=\\s|,|\\.|;|:|$)", element_types: ["paragraph", "heading"]}
      
  # Executives
  - term_id: "ceo"
    rules:
      - {<<: *semantic_text_high, semantic_phrase: *ceo_phrase}
      - {<<: *regex_high, pattern: "\\b(CEO|Chief Executive)\\b"}
      
  - term_id: "cfo"
    rules:
      - {<<: *semantic_text_high, semantic_phrase: *cfo_phrase}
      - {<<: *regex_high, pattern: "\\b(CFO|Chief Financial)\\b"}
      
  - term_id: "analyst"
    rules:
      - {<<: *semantic_text_medium, semantic_phrase: *analyst_phrase}
      - {<<: *keywords_medium, keywords: ["analyst", "research"]}
      
  # Financial Metrics
  - term_id: "revenue"
    rules:
      - {<<: *semantic_text_medium, semantic_phrase: *revenue_phrase}
      - {<<: *regex_medium, pattern: "\\$?\\d+\\.?\\d*\\s*(million|billion|M|B)\\s*(in\\s+)?(revenue|sales)"}
      
  - term_id: "earnings"
    rules:
      - {<<: *semantic_text_medium, semantic_phrase: *earnings_phrase}
      - {<<: *keywords_medium, keywords: ["earnings", "profit", "income"]}
      
  - term_id: "margin"
    rules:
      - {<<: *semantic_text_medium, semantic_phrase: *margin_phrase}
      - {<<: *regex_medium, pattern: "\\d+\\.?\\d*\\s*%\\s*margin"}
      
  - term_id: "growth_rate"
    rules:
      - {<<: *semantic_low, semantic_phrase: "year over year growth, YoY, quarter over quarter, QoQ, CAGR"}
      - {<<: *regex_medium, pattern: "\\d+\\.?\\d*\\s*%\\s*(growth|increase|decline)"}
      
  - term_id: "guidance"
    rules:
      - {<<: *semantic_text_medium, semantic_phrase: *guidance_phrase}
      - {<<: *keywords_medium, keywords: ["guidance", "outlook", "forecast"]}
      
  # Market Sentiment
  - term_id: "bullish"
    rules:
      - {<<: *semantic_text_low, semantic_phrase: *bullish_phrase}
      - {<<: *keywords_low, keywords: ["bullish", "positive", "optimistic"]}
      
  - term_id: "bearish"
    rules:
      - {<<: *semantic_text_low, semantic_phrase: *bearish_phrase}
      - {<<: *keywords_low, keywords: ["bearish", "negative", "pessimistic"]}
      
  # Risk and Opportunity
  - term_id: "risk"
    rules:
      - {<<: *semantic_low, semantic_phrase: *risk_phrase}
      - {<<: *keywords_low, keywords: ["risk", "threat", "challenge", "headwind", "concern", "pressure"]}
      
  - term_id: "opportunity"
    rules:
      - {<<: *semantic_low, semantic_phrase: *opportunity_phrase}
      - {<<: *keywords_low, keywords: ["opportunity", "potential", "tailwind", "catalyst", "driver", "upside"]}

# Relationship rules between terms
relationship_rules:
  # Executive relationships
  - id: "company_has_ceo"
    relationship_type: "has_executive"
    description: "Company has CEO"
    source: *company_source_medium
    target: {<<: *exec_target_high, term_id: "ceo", semantic_phrase: *exec_phrase}
    confidence: *confidence_low
    constraints: *same_para
      
  - id: "company_has_cfo"
    relationship_type: "has_executive"
    description: "Company has CFO"
    source: *company_source_medium
    target: {<<: *exec_target_high, term_id: "cfo", semantic_phrase: *cfo_phrase}
    confidence: *confidence_low
    constraints: *same_para
      
  # Business relationships
  - id: "company_competes_with"
    relationship_type: "competes_with"
    description: "Company competes with another"
    source: *company_source_firm
    target: {<<: *target_medium, term_id: "competitor", semantic_phrase: *competitor_phrase}
    confidence: *confidence_low
    bidirectional: true

  - id: "company_has_customer"
    relationship_type: "has_customer"
    description: "Company has customer"
    source: {term_id: "company", semantic_phrase: "company, we, our, supplier, vendor", confidence_threshold: *medium}
    target: {<<: *target_medium, term_id: "customer", semantic_phrase: *customer_phrase}
    confidence: *confidence_low
    
  # Financial reporting
  - id: "company_reports_revenue"
    relationship_type: "reports"
    description: "Company reports revenue"
    source: *company_source_short
    target: {<<: *target_medium, term_id: "revenue", semantic_phrase: *revenue_phrase}
    confidence: *confidence_low
    constraints: *same_section

  - id: "company_provides_guidance"
    relationship_type: "provides"
    description: "Company provides guidance"
    source: {term_id: "company", semantic_phrase: *management_phrase, confidence_threshold: *medium}
    target: {<<: *target_medium, term_id: "guidance", semantic_phrase: *guidance_phrase}
    confidence: *confidence_low
    constraints: *same_section
    
  # Analyst relationships
  - id: "analyst_rates_company"
    relationship_type: "rates"
    description: "Analyst rates company"
    source: {<<: *target_medium, term_id: "analyst", semantic_phrase: *analyst_phrase}
    target: *company_source_medium
    confidence: *confidence_low
    constraints: *same_section
    
  - id: "analyst_sets_price_target"
    relationship_type: "sets_target"
    description: "Analyst sets price target"
    source: {<<: *target_medium, term_id: "analyst", semantic_phrase: *analyst_phrase}
    target: {<<: *target_medium, term_id: "price_target", semantic_phrase: "price target, target price, PT"}
    confidence: *confidence_medium
    constraints: *same_para
    
  # Market sentiment
  - id: "company_sentiment_bullish"
    relationship_type: "has_sentiment"
    description: "Company has bullish sentiment"
    source: *company_source_medium
    target: {<<: *target_medium, term_id: "bullish", semantic_phrase: *bullish_phrase}
    confidence: *confidence_low
    constraints: *same_section
    
  - id: "company_sentiment_bearish"
    relationship_type: "has_sentiment"
    description: "Company has bearish sentiment"
    source: *company_source_medium
    target: {<<: *target_medium, term_id: "bearish", semantic_phrase: *bearish_phrase}
    confidence: *confidence_low
    constraints: *same_section
    
  # Corporate actions
  - id: "company_acquires"
    relationship_type: "acquires"
    description: "Company acquires another"
    source: *company_source_medium
    target: {<<: *target_medium, term_id: "acquisition", semantic_phrase: *target_phrase}
    confidence: *confidence_medium
    constraints: *same_doc
    
  - id: "company_launches_product"
    relationship_type: "launches"
    description: "Company launches product"
    source: *company_source_medium
    target: {<<: *target_medium, term_id: "product", semantic_phrase: *product_phrase}
    confidence: *confidence_low
    constraints: *same_section

# Derived entity extraction rules
derived_entity_rules:
  - <<: *speaker_entity
  - <<: *comment_entity
  
  - entity_type: "financial_metric"
    source_element_types: ["table_cell", "paragraph"]
    metadata_fields: ["metric_name", "value", "period"]
    id_template: "metric_{metric_name}_{period}"
    deduplication_key: "metric_id"
    create_relationships: true
    relationship_type: "HAS_METRIC"

# Entity-to-entity relationship rules
entity_relationship_rules:
  - name: "speaker_company_relationship"
    description: "Speaker represents company"
    <<: *speaker_company_rel
    matching_criteria: *same_doc_match
    
  - name: "speaker_comment_relationship"
    description: "Speaker makes comment"
    source_entity_type: "speaker"
    target_entity_type: "earnings_call_comment"
    relationship_type: "MAKES_COMMENT"
    matching_criteria:
      <<: *same_element_match
      metadata_match:
        - {source_field: "name", target_field: "speaker"}
    confidence: 0.95
    
  - name: "cfo_company_relationship"
    description: "CFO works for company"
    source_entity_type: "speaker"
    target_entity_type: "company"
    relationship_type: "WORKS_FOR"
    matching_criteria:
      <<: *same_doc_match
      metadata_match:
        - {source_field: "speaker_role", source_value: "CFO", target_field: "company", match_type: "exists"}
    confidence: 0.95

# Domain-specific settings
# Note: Only implemented settings are included here.
# See docs/design-ideas.md for aspirational features.
settings:
  enable_transitive_inference: false  # Currently implemented but disabled by default
  default_confidence_threshold: 0.70  # Default confidence for all rules
  max_relationships_per_pair: 3       # Limit relationships between same entities